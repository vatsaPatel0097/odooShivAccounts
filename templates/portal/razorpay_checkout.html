{% extends "base.html" %}
{% block content %}
<h2>Pay Invoice #{{ invoice.pk }}</h2>
<p>Amount Due: â‚¹{{ amount_due }}</p>

<button id="rzp-button">Pay with Razorpay</button>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
var options = {
    "key": "{{ razorpay_key_id }}",
    "amount": "{{ razor_order.amount }}",
    "currency": "{{ razor_order.currency }}",
    "name": "Shiv Accounts",
    "description": "Invoice #{{ invoice.pk }}",
    "order_id": "{{ razor_order.id }}",
    "handler": function (response){
        fetch("{% url 'portal_invoice_razorpay_verify' invoice.pk %}", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(response)
        }).then(res => res.json()).then(data => {
            alert("Payment Success!");
            window.location.href = "{% url 'customer_portal_invoices' %}";
        }).catch(err => {
            alert("Payment verification failed.");
        });
    },
    "prefill": {
        "name": "{{ request.session.customer_name|default:'' }}",
        "email": "{{ request.session.customer_email|default:'' }}"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp = new Razorpay(options);
document.getElementById('rzp-button').onclick = function(e){
    rzp.open();
    e.preventDefault();
}
</script>
{% endblock %}
